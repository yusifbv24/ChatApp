@inject NavigationManager Navigation

@code {
    protected override void OnInitialized()
    {
        // Get the current URL path (without the domain)
        var currentUrl = Navigation.ToBaseRelativePath(Navigation.Uri);
        
        // Remove any existing query parameters from the current URL to get just the path
        // This prevents query parameter accumulation if someone bookmarks a URL with returnUrl
        var path = currentUrl.Split('?')[0];
        
        // Build the login URL with the return path as a query parameter
        // The Uri.EscapeDataString ensures special characters in the path are properly encoded
        // For example, if path contains spaces or special chars, they won't break the URL
        var loginUrl = $"/login?returnUrl={Uri.EscapeDataString(path)}";
        
        // Perform the navigation
        // forceLoad: false means this is a client-side navigation (no page reload)
        // This keeps it fast and smooth - the whole Blazor app stays loaded in memory
        Navigation.NavigateTo(loginUrl, forceLoad: false);
        
        /*
            WHY NOT USE forceLoad: true?
            ============================
            If we used forceLoad: true, the entire browser page would reload, which means:
            1. The Blazor runtime would need to download again (slower)
            2. Any state in memory would be lost
            3. It would feel clunky to the user
            
            With forceLoad: false, the redirect happens instantly within the already-loaded
            Blazor app. Much better user experience.
            
            The only time you'd want forceLoad: true is if you're navigating to a
            completely different website or need to clear all in-memory state for
            security reasons.
        */
    }
}