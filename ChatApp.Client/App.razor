@using ChatApp.Client.Shared
<CascadingAuthenticationState>
    <Router AppAssembly="@typeof(App).Assembly">
        <Found Context="routeData">
            <AuthorizeRouteView RouteData="@routeData" DefaultLayout="@typeof(MainLayout)">
                <NotAuthorized>
                    @if (context.User.Identity?.IsAuthenticated ?? false)
                    {
                        <!-- User is logged in but lacks permissions -->
                        <div class="d-flex justify-center align-center" style="height: 100vh;">
                            <MudPaper Class="pa-8" Elevation="4">
                                <MudText Typo="Typo.h4" Class="mb-4">Access Denied</MudText>
                                <MudText Typo="Typo.body1" Class="mb-4">
                                    You don't have permission to access this page.
                                </MudText>
                                <MudText Typo="Typo.body2" Color="Color.Secondary">
                                    If you believe this is an error, please contact your administrator.
                                </MudText>
                                <MudButton Variant="Variant.Filled" 
                                          Color="Color.Primary" 
                                          Href="/"
                                          Class="mt-4">
                                    Go to Dashboard
                                </MudButton>
                            </MudPaper>
                        </div>
                    }
                    else
                    {
                        <!--
                            User is not logged in at all
                            Redirect them to login page
                            The RedirectToLogin component handles the redirect logic
                        -->
                        <RedirectToLogin />
                    }
                </NotAuthorized>
                <Authorizing>
                    <div class="d-flex justify-center align-center" style="height: 100vh;">
                        <MudProgressCircular Color="Color.Primary" 
                                           Size="Size.Large" 
                                           Indeterminate="true" />
                    </div>
                </Authorizing>
            </AuthorizeRouteView>
            <!--
                FOCUS ON NAVIGATION: Accessibility feature
                This handles keyboard navigation for accessibility.
                When a page changes, screen readers announce the navigation.
                This is important for users who rely on assistive technologies.
            -->
            <FocusOnNavigate RouteData="@routeData" Selector="h1" />
        </Found>
        <NotFound>
            <PageTitle>Page Not Found</PageTitle>
            <LayoutView Layout="@typeof(MainLayout)">
                <div class="d-flex justify-center align-center" style="height: 100vh;">
                    <MudPaper Class="pa-8" Elevation="4">
                        <MudText Typo="Typo.h3" Class="mb-4">404</MudText>
                        <MudText Typo="Typo.h5" Class="mb-4">Page Not Found</MudText>
                        <MudText Typo="Typo.body1" Class="mb-4">
                            Sorry, the page you're looking for doesn't exist.
                        </MudText>
                        <MudButton Variant="Variant.Filled" 
                                  Color="Color.Primary" 
                                  Href="/">
                            Go to Dashboard
                        </MudButton>
                    </MudPaper>
                </div>
            </LayoutView>
        </NotFound>
    </Router>
</CascadingAuthenticationState>